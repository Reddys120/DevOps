- name: Check if nginx is installed using package_facts
  hosts: 172.31.46.186
  become: true
  tasks:

    - name: Gather package facts
      ansible.builtin.package_facts:

    - name: Display if nginx is installed
      debug:
        msg: "NGINX is already installed"
      when: "'nginx' in ansible_facts.packages"

    - name: Install nginx if not installed
      ansible.builtin.package:
        name: nginx
        state: present
      when: "'nginx' not in ansible_facts.packages"
